# MPV Configuration for Asahi Linux (ARM64)
# Optimized for Apple Silicon M1 Max with Asahi GPU driver
# 60Hz display @ 3456x2160, software decode, Asahi audio stack

# ===== VIDEO OUTPUT =====
vo=gpu
gpu-api=vulkan
gpu-context=waylandvk
hwdec=no                         # No hardware decode on Asahi yet

# ===== DISPLAY SYNC FOR SMOOTH PLAYBACK =====
# Critical for smooth 24fps/30fps video on 60Hz display
video-sync=display-resample      # Sync video to display refresh rate
interpolation=yes                # Interpolate frames for buttery smooth motion
tscale=oversample                # Temporal scaling algorithm (fast, good quality)

# ===== PERFORMANCE =====
vd-lavc-threads=8                # 8 threads for video decode (M1 Max has 10 cores)
vd-lavc-dr=yes                   # Direct rendering
opengl-pbo=yes                   # Pixel buffer objects for faster uploads
cache=yes
demuxer-max-bytes=400M           # Large cache for streaming (you have 64GB RAM)
demuxer-max-back-bytes=200M      # Back buffer

# Frame timing and drops
framedrop=vo                     # Drop frames if needed to maintain A/V sync
video-latency-hacks=yes          # Reduce video latency
untimed=no                       # Keep timing

# ===== SCALING - SIMPLE FOR PERFORMANCE =====
scale=bilinear
cscale=bilinear
dscale=bilinear
dither-depth=auto
deband=no
sigmoid-upscaling=no
correct-downscaling=no

# ===== AUDIO - AGGRESSIVELY OPTIMIZED FOR ASAHI CRACKLING =====
# Multiple strategies to combat Asahi audio issues
ao=pipewire,pulse,alsa           # Try pipewire first, fallback to pulse, then alsa
audio-buffer=1.0                 # 1 second buffer (very aggressive, but Asahi needs it)
audio-samplerate=48000           # Match PipeWire rate
audio-channels=stereo
volume=100
volume-max=150

# Audio device settings
audio-wait-open=3.0              # Wait up to 3s for audio device
audio-exclusive=no               # Don't request exclusive mode

# Timing and synchronization
audio-pitch-correction=yes       # Maintain pitch during speed changes
video-sync-max-video-change=0.1  # Allow small video speed adjustments
video-sync-max-audio-change=0.125 # Allow small audio speed adjustments

# ===== OSD/SUBTITLES =====
osd-level=1
osd-duration=2500
osd-font-size=32
sub-auto=fuzzy
sub-file-paths=ass:srt:sub:subs:subtitles
sub-font-size=36

# ===== SCREENSHOTS =====
screenshot-format=png
screenshot-png-compression=8
screenshot-directory=~/Pictures/Screenshots

# ===== MISC =====
keep-open=yes
save-position-on-quit=yes
watch-later-directory=~/.config/mpv/watch_later
msg-level=all=warn               # Reduce log spam
term-osd-bar=yes                 # Progress bar in terminal
cursor-autohide=1000             # Hide cursor after 1s

# ===== PROFILES =====
# Use with: mpv --profile=<name> file

[stremio]
profile-desc="Optimized for Stremio streaming"
audio-buffer=1.5                 # Even larger audio buffer for streaming
cache-pause=yes                  # Pause when cache runs low
cache-pause-initial=yes          # Start paused until cache fills
demuxer-readahead-secs=60        # Read ahead 60 seconds
force-seekable=yes               # Allow seeking in streams
prefetch-playlist=yes            # Prefetch next item

[local]
profile-desc="For local high-quality files"
audio-buffer=0.2                 # Smaller buffer for local files
scale=spline36                   # Better scaling for local content
cscale=spline36
deband=yes

[lowend]
profile-desc="Maximum compatibility, lowest resource usage"
vo=gpu
interpolation=no                 # Disable interpolation
video-sync=audio                 # Simple audio sync
scale=bilinear
audio-buffer=2.0                 # Maximum audio buffer
framedrop=decoder+vo             # Aggressive frame dropping
