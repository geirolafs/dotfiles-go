From: go <go@macbook>
Date: Sun, 29 Sep 2025 00:15:00 +0000
Subject: [PATCH] Fix screen recording on ARM64 by using wf-recorder

wl-screenrec is not available for ARM64 architecture, but wf-recorder
works perfectly on Apple Silicon and other ARM systems. This patch
modifies the screen recording script to:

1. Check for available recorders rather than GPU type
2. Prefer wf-recorder as it's more widely available
3. Fall back to wl-screenrec only if available and wf-recorder isn't

This fixes screen recording on Apple Silicon Macs running Asahi Linux
and other ARM64 systems where wl-screenrec isn't available.

--- a/bin/omarchy-cmd-screenrecord
+++ b/bin/omarchy-cmd-screenrecord
@@ -17,11 +17,19 @@ AUDIO=$([[ $2 == "audio" ]] && echo "--audio")
 start_screenrecording() {
   filename="$OUTPUT_DIR/screenrecording-$(date +'%Y-%m-%d_%H-%M-%S').mp4"

-  if lspci | grep -qi 'nvidia'; then
+  # Check which screen recorder is available
+  # Prefer wf-recorder as it's more widely available (especially on ARM64)
+  if command -v wf-recorder >/dev/null 2>&1; then
     wf-recorder $AUDIO -f "$filename" -c libx264 -p crf=23 -p preset=medium -p movflags=+faststart "$@" &
-  else
+  elif command -v wl-screenrec >/dev/null 2>&1; then
     wl-screenrec $AUDIO -f "$filename" --ffmpeg-encoder-options="-c:v libx264 -crf 23 -preset medium -movflags +faststart" "$@" &
+  else
+    notify-send "No screen recorder available" "Please install wf-recorder or wl-screenrec" -u critical -t 5000
+    exit 1
   fi

   toggle_screenrecording_indicator
 }